{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _jsxFileName = \"/home/michael/coding/tudu/app/App.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport \"@babel/polyfill\";\nimport HomeScreen from \"./screens/HomeScreen\";\nimport SplashScreen from \"./screens/SplashScreen\";\nimport LoginScreen from \"./screens/LoginScreen\";\nimport Amplify from \"aws-amplify\";\nimport awsmobile from \"./aws-exports\";\nAmplify.configure(_objectSpread(_objectSpread({}, awsmobile), {}, {\n  Analytics: {\n    disabled: true\n  }\n}));\nimport React, { useEffect, createContext } from 'react';\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport { createStackNavigator } from \"@react-navigation/stack\";\nimport { AsyncStorage } from \"react-native-web/dist/index\";\nimport StatusBar from \"react-native-web/dist/exports/StatusBar\";\nvar theme = {\n  dark: true,\n  colors: {\n    primary: '#e0e1dd',\n    background: '#1b263b',\n    card: '#0d1b2a',\n    text: '#a7a7a7',\n    border: 'transparent',\n    notification: '#000000'\n  }\n};\nvar Stack = createStackNavigator();\nexport default function App(_ref) {\n  var navigation = _ref.navigation;\n\n  var _React$useReducer = React.useReducer(function (prevState, action) {\n    switch (action.type) {\n      case 'RESTORE_TOKEN':\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          userToken: action.token,\n          isLoading: false\n        });\n\n      case 'LOGIN':\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          isSignout: false,\n          userToken: action.token\n        });\n\n      case 'LOGOUT':\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          isSignout: true,\n          userToken: null\n        });\n    }\n  }, {\n    isLoading: true,\n    isSignout: false,\n    userToken: null\n  }),\n      _React$useReducer2 = _slicedToArray(_React$useReducer, 2),\n      state = _React$useReducer2[0],\n      dispatch = _React$useReducer2[1];\n\n  useEffect(function () {\n    var restoreToken = function restoreToken() {\n      var userToken;\n      return _regeneratorRuntime.async(function restoreToken$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem('auth-token'));\n\n            case 3:\n              userToken = _context.sent;\n              _context.next = 9;\n              break;\n\n            case 6:\n              _context.prev = 6;\n              _context.t0 = _context[\"catch\"](0);\n              alert(_context.t0);\n\n            case 9:\n              dispatch({\n                type: 'RESTORE_TOKEN',\n                token: userToken\n              });\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[0, 6]], Promise);\n    };\n\n    restoreToken();\n  }, []);\n  var authContext = React.useMemo(function () {\n    return {\n      login: function login(username, password) {\n        var loginRequest, token;\n        return _regeneratorRuntime.async(function login$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return _regeneratorRuntime.awrap(fetch('http://192.168.2.11:3000/api/user/login', {\n                  method: 'POST',\n                  headers: {\n                    Accept: 'application/json',\n                    'Content-Type': 'application/json'\n                  },\n                  body: JSON.stringify({\n                    username: username,\n                    password: password\n                  })\n                }));\n\n              case 3:\n                loginRequest = _context2.sent;\n\n                if (!(loginRequest.status == 200)) {\n                  _context2.next = 14;\n                  break;\n                }\n\n                _context2.next = 7;\n                return _regeneratorRuntime.awrap(loginRequest.text());\n\n              case 7:\n                token = _context2.sent;\n                alert(token);\n                _context2.next = 11;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem('auth-token', token));\n\n              case 11:\n                dispatch({\n                  type: 'LOGIN',\n                  token: token\n                });\n                _context2.next = 17;\n                break;\n\n              case 14:\n                _context2.next = 16;\n                return _regeneratorRuntime.awrap(loginRequest.text());\n\n              case 16:\n                throw _context2.sent;\n\n              case 17:\n                _context2.next = 23;\n                break;\n\n              case 19:\n                _context2.prev = 19;\n                _context2.t0 = _context2[\"catch\"](0);\n                alert('There was an error signing in! Error: ' + _context2.t0);\n                dispatch({\n                  type: 'LOGOUT'\n                });\n\n              case 23:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, null, null, [[0, 19]], Promise);\n      },\n      logout: function logout() {\n        return _regeneratorRuntime.async(function logout$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return _regeneratorRuntime.awrap(AsyncStorage.setItem('auth-token', 'null'));\n\n              case 3:\n                _context3.next = 8;\n                break;\n\n              case 5:\n                _context3.prev = 5;\n                _context3.t0 = _context3[\"catch\"](0);\n                alert('There was an error signing out! Error: ' + _context3.t0);\n\n              case 8:\n                dispatch({\n                  type: 'LOGOUT'\n                });\n\n              case 9:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, null, null, [[0, 5]], Promise);\n      },\n      register: function register(data) {\n        return _regeneratorRuntime.async(function register$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                dispatch({\n                  type: 'LOGIN',\n                  token: 'dummy-auth-token'\n                });\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, null, null, null, Promise);\n      }\n    };\n  }, []);\n  var AuthContext = createContext({});\n\n  if (state.isLoading) {\n    return React.createElement(SplashScreen, null);\n  } else {\n    return React.createElement(AuthContext.Provider, {\n      value: authContext\n    }, React.createElement(NavigationContainer, {\n      theme: theme\n    }, React.createElement(StatusBar, {\n      backgroundColor: theme.colors.background\n    }), React.createElement(Stack.Navigator, null, state.isLoading ? React.createElement(Stack.Screen, {\n      name: \"Splash\",\n      component: SplashScreen\n    }) : state.userToken == null ? React.createElement(Stack.Screen, {\n      name: \"SignIn\",\n      component: LoginScreen,\n      options: {\n        animationTypeForReplace: state.isSignout ? 'pop' : 'push',\n        headerShown: false\n      }\n    }) : React.createElement(Stack.Screen, {\n      name: \"Home\",\n      component: HomeScreen\n    }))));\n  }\n}","map":{"version":3,"sources":["/home/michael/coding/tudu/app/App.tsx"],"names":["HomeScreen","SplashScreen","LoginScreen","Amplify","awsmobile","configure","Analytics","disabled","React","useEffect","createContext","NavigationContainer","createStackNavigator","AsyncStorage","theme","dark","colors","primary","background","card","text","border","notification","Stack","App","navigation","useReducer","prevState","action","type","userToken","token","isLoading","isSignout","state","dispatch","restoreToken","getItem","alert","authContext","useMemo","login","username","password","fetch","method","headers","Accept","body","JSON","stringify","loginRequest","status","setItem","logout","register","data","AuthContext","animationTypeForReplace","headerShown"],"mappings":"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","sourcesContent":["import \"@babel/polyfill\"; // hacky fix that makes the web verison work\n// import React from 'react';\n// import { StyleSheet, Text, View } from 'react-native';\nimport HomeScreen from \"./screens/HomeScreen\";\n// import DetailsScreen from \"./screens/DetailsScreen\";\nimport SplashScreen from \"./screens/SplashScreen\";\nimport LoginScreen from \"./screens/LoginScreen\";\n\nimport Amplify from \"aws-amplify\";\nimport awsmobile from \"./aws-exports\";\nAmplify.configure({ ...awsmobile, Analytics: { disabled: true } }); // Note: Disabling analytics was a hacky way of getting warning to disappear\n\nimport React, {useEffect, createContext} from 'react';\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport { createStackNavigator } from \"@react-navigation/stack\";\nimport { AsyncStorage, Button, Text, TextInput, View, StatusBar } from \"react-native\";\n\n// Theming\nconst theme = {\n  dark: true,\n  colors: {\n    primary: '#e0e1dd',\n    background: '#1b263b',\n    card: '#0d1b2a',\n    text: '#a7a7a7',\n    // hintText: '#a8a8a8',\n    // inputText: '#ffffff',\n    border: 'transparent',\n    notification: '#000000'\n  },\n};\n\n// Setup Layout\nconst Stack = createStackNavigator();\n\nexport default function App({ navigation }) {\n  const [state, dispatch] = React.useReducer(\n    (prevState, action) => {\n      switch (action.type) {\n        case 'RESTORE_TOKEN':\n          return {\n            ...prevState,\n            userToken: action.token,\n            isLoading: false,\n          };\n        case 'LOGIN':\n          return {\n            ...prevState,\n            isSignout: false,\n            userToken: action.token,\n          };\n        case 'LOGOUT':\n          return {\n            ...prevState,\n            isSignout: true,\n            userToken: null,\n          };\n      }\n    },\n    {\n      isLoading: true,\n      isSignout: false,\n      userToken: null,\n    },\n  );\n\n  // on app start\n  useEffect(() => {\n    const restoreToken = async () => {\n      let userToken;\n      try {\n        userToken = await AsyncStorage.getItem('auth-token');\n      } catch (e) {\n        // Restoring token failed\n        alert(e);\n      }\n      dispatch({type: 'RESTORE_TOKEN', token: userToken});\n    };\n\n    restoreToken();\n  }, []);\n\n  // the auth functions\n  const authContext = React.useMemo(\n    () => ({\n      login: async (username, password) => {\n        try {\n          var loginRequest = await fetch(\n            'http://192.168.2.11:3000/api/user/login',\n            {\n              method: 'POST',\n              headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({\n                username: username,\n                password: password,\n              }),\n            },\n          );\n          if (loginRequest.status == 200) {\n            var token = await loginRequest.text();\n            alert(token);\n            await AsyncStorage.setItem('auth-token', token);\n            dispatch({type: 'LOGIN', token: token});\n          } else {\n            throw await loginRequest.text();\n          }\n        } catch (error) {\n          alert('There was an error signing in! Error: ' + error);\n          dispatch({type: 'LOGOUT'});\n        }\n      },\n      logout: async () => {\n        try {\n          await AsyncStorage.setItem('auth-token', 'null');\n        } catch (error) {\n          alert('There was an error signing out! Error: ' + error);\n        }\n        dispatch({type: 'LOGOUT'});\n      },\n      register: async (data) => {\n        // In a production app, we need to send user data to server and get a token\n        // We will also need to handle errors if sign up failed\n        // After getting token, we need to persist the token using `AsyncStorage`\n        // In the example, we'll use a dummy token\n\n        dispatch({type: 'LOGIN', token: 'dummy-auth-token'});\n      },\n    }),\n    [],\n  );\n  // Setup Global State\n  const AuthContext = createContext({});\n\n  if (state.isLoading) {\n    return <SplashScreen />;\n  } else {\n    return (\n      <AuthContext.Provider value={authContext}>\n        <NavigationContainer theme={theme}>\n          <StatusBar backgroundColor={theme.colors.background} />\n          <Stack.Navigator>\n            {state.isLoading ? (\n              <Stack.Screen name=\"Splash\" component={SplashScreen} />\n            ) : state.userToken == null ? (\n              <Stack.Screen\n                name=\"SignIn\"\n                component={LoginScreen}\n                options={{\n                  animationTypeForReplace: state.isSignout ? 'pop' : 'push',\n                  headerShown: false,\n                }}\n              />\n            ) : (\n              // User is signed in\n              <Stack.Screen name=\"Home\" component={HomeScreen} />\n              // <Stack.Screen name=\"Home\" component={SettingsScreen} initialParams={AuthContext} />\n            )}\n          </Stack.Navigator>\n        </NavigationContainer>\n      </AuthContext.Provider>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}